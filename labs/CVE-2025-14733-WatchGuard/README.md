# CVE-2025-14733 - WatchGuard Firebox unauth RCE lab setup


1. **Setup vulnerable WatchGuard Firebox VM**

* Download a vulnerable VM image of FireboxV: https://cdn.watchguard.com/SoftwareCenter/Files/XTM/12_10_1/FireboxV_12_10_1.ova
* Follow https://www.watchguard.com/help/docs/help-center/fr-FR/Content/en-US/Fireware/firebox_v/fbv_setup_kvm.html?tocpath=Fireware%7CAide%20Fireware%7CConfigurer%20et%C2%A0Administrer%20Votre%20Firebox%7CConfigurer%20FireboxV%20et%20XTMv%7C_____9 to extract a QCOW2 image from the OVA:
```bash
tar xvf *.ova
qemu-img convert -f vmdk -O qcow2 FireboxV_12_10_1_signed-disk1.vmdk vulnerable/FireboxV_12_10_1.qcow2
```

Start the VM, with a NIC exposing UDP ports 500 and 4500 locally:
```bash
./run-vulnerable.sh
```

NOTE: FireboxV WebUI is only accessible via the TRUSTED management interface (https://10.0.10.2:8443)
NOTE: By default, FireboxV comes with IKEv2 VPN service disabled. You need to enable it by logging into the web admin panel (default credentials: `admin`/`readwrite`), navigating to VPN > Mobile User VPN, enabling IKEv2, and applying the configuration.

To easily collect logs from the Firebox VM, we setup a rsyslog server listening on UFD port 514 on the host machine, that prints all logs to stdout:
```bash
docker compose up rsyslog
```

!!! BLOCKED : I've tried to setup Mobile VPN with IKEv2 on the Firebox appliance... without luck...
!!! tcpdump shows the IKE_SA_INIT request being sent from the client to the Firebox, but no response is received from the Firebox.
!!! enabling promisc mode and disabling reverse path filtering on the TAP interface didn't help.

2. **Exploit the vulnerability**

```bash
uv run python3 poc.py
```

3. **Probe the vulnerability without exploitation**

```bash
uv run python3 probe.py
```

4. **Check patched WatchGuard Firebox VM isn't vulnerable**

* Download a patched VM image of FireboxV: https://cdn.watchguard.com/SoftwareCenter/Files/XTM/12_11_6/FireboxV_12_11_6.ova
* Extract a QCOW2 image from the OVA as above, unzip it to `patched/` and start the VM:
```bash
./run-patched.sh
```

The patched VM should answer IKEv2 requests normally without crashing/hanging, and should report a non-vulnerable version number in IKE_SA_INIT responses.


5. **Scan using ike-scan**

You can use [ike-scan](https://github.com/royhills/ike-scan) to probe and explore the vulnerability without exploiting it:

```bash
ike-scan -p 500 -v 10.0.10.2
```